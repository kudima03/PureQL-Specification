{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "definitions": {
    "betweenCondition": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "value",
        "min",
        "max"
      ],
      "properties": {
        "kind": {
          "const": "between"
        },
        "value": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            },
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/betweenCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        },
        "min": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            },
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/betweenCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        },
        "max": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            },
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        }
      }
    },
    "binaryCompareCondition": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "operator",
        "left",
        "right"
      ],
      "properties": {
        "kind": {
          "const": "compare"
        },
        "operator": {
          "type": "string",
          "enum": [
            "equal",
            "notEqual",
            "greaterThan",
            "greaterOrEqual",
            "lessThan",
            "lessOrEqual",
            "contains",
            "startsWith",
            "endsWith",
            "like"
          ]
        },
        "left": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            },
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        },
        "right": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            },
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        }
      }
    },
    "logicCondition": {
      "type": "object",
      "required": [
        "kind",
        "conditions"
      ],
      "properties": {
        "kind": {
          "enum": [
            "and",
            "or"
          ]
        },
        "conditions": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/definitions/binaryCompareCondition"
              },
              {
                "$ref": "#/definitions/betweenCondition"
              },
              {
                "$ref": "#/definitions/inCondition"
              },
              {
                "$ref": "#/definitions/logicCondition"
              },
              {
                "$ref": "#/definitions/unaryExpression"
              }
            ]
          },
          "minItems": 1
        }
      },
      "additionalProperties": false
    },
    "inCondition": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "left",
        "right"
      ],
      "properties": {
        "kind": {
          "enum": [
            "in",
            "notIn"
          ]
        },
        "left": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            }
          ]
        },
        "right": {
          "type": "array",
          "minItems": 1,
          "items": {
            "oneOf": [
              {
                "$ref": "#/definitions/fieldExpression"
              },
              {
                "$ref": "#/definitions/aggregateExpression"
              },
              {
                "$ref": "#/definitions/functionExpression"
              },
              {
                "$ref": "#/definitions/unaryExpression"
              },
              {
                "$ref": "#/definitions/literalExpression"
              },
              {
                "$ref": "#/definitions/parameterExpression"
              }
            ]
          }
        }
      }
    },
    "fieldExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "entity",
        "name"
      ],
      "properties": {
        "kind": {
          "const": "field"
        },
        "entity": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "joinItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "entity",
        "on"
      ],
      "properties": {
        "type": {
          "enum": [
            "left",
            "right",
            "inner",
            "full"
          ]
        },
        "entity": {
          "type": "string",
          "minLength": 1
        },
        "on": {
          "oneOf": [
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/betweenCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        }
      }
    },
    "aggregateExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "name",
        "arg"
      ],
      "properties": {
        "kind": {
          "const": "aggregate"
        },
        "name": {
          "type": "string",
          "enum": [
            "sum",
            "avg",
            "min",
            "max",
            "count"
          ]
        },
        "arg": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            }
          ]
        }
      }
    },
    "functionExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "name",
        "args"
      ],
      "properties": {
        "kind": {
          "const": "function"
        },
        "name": {
          "type": "string",
          "enum": [
            "lower",
            "upper",
            "length",
            "trim",
            "contains",
            "abs",
            "round",
            "floor",
            "ceiling",
            "now",
            "date_add",
            "date_diff"
          ]
        },
        "args": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/definitions/fieldExpression"
              },
              {
                "$ref": "#/definitions/aggregateExpression"
              },
              {
                "$ref": "#/definitions/functionExpression"
              },
              {
                "$ref": "#/definitions/unaryExpression"
              },
              {
                "$ref": "#/definitions/literalExpression"
              },
              {
                "$ref": "#/definitions/parameterExpression"
              }
            ]
          }
        }
      }
    },
    "unaryExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "operator",
        "operand"
      ],
      "properties": {
        "kind": {
          "const": "unary"
        },
        "operator": {
          "type": "string",
          "enum": [
            "neg",
            "not"
          ]
        },
        "operand": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            },
            {
              "$ref": "#/definitions/binaryCompareCondition"
            },
            {
              "$ref": "#/definitions/betweenCondition"
            },
            {
              "$ref": "#/definitions/inCondition"
            },
            {
              "$ref": "#/definitions/logicCondition"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            }
          ]
        }
      }
    },
    "fromEntity": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "entity"
      ],
      "properties": {
        "entity": {
          "type": "string",
          "minLength": 1
        },
        "alias": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "selectItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "expression"
      ],
      "properties": {
        "expression": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            }
          ]
        },
        "alias": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "orderByItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "expression"
      ],
      "properties": {
        "expression": {
          "oneOf": [
            {
              "$ref": "#/definitions/fieldExpression"
            },
            {
              "$ref": "#/definitions/aggregateExpression"
            },
            {
              "$ref": "#/definitions/functionExpression"
            },
            {
              "$ref": "#/definitions/unaryExpression"
            },
            {
              "$ref": "#/definitions/literalExpression"
            },
            {
              "$ref": "#/definitions/parameterExpression"
            }
          ]
        },
        "direction": {
          "type": "string",
          "enum": [
            "asc",
            "desc"
          ],
          "default": "asc"
        }
      }
    },
    "pagination": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "skip",
        "take"
      ],
      "properties": {
        "skip": {
          "type": "integer",
          "minimum": 0
        },
        "take": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "parameterDeclaration": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "integer",
            "float",
            "decimal",
            "string",
            "boolean",
            "date",
            "time",
            "dateTime",
            "null"
          ]
        }
      }
    },
    "literalExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "value",
        "type"
      ],
      "properties": {
        "kind": {
          "const": "literal"
        },
        "value": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "integer",
            "float",
            "decimal",
            "string",
            "boolean",
            "date",
            "time",
            "dateTime",
            "null"
          ]
        }
      }
    },
    "parameterExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "name"
      ],
      "properties": {
        "kind": {
          "const": "parameter"
        },
        "name": {
          "type": "string",
          "minLength": 1
        }
      }
    }
  },
  "properties": {
    "distinct": {
      "type": "boolean",
      "default": false
    },
    "from": {
      "$ref": "#/definitions/fromEntity"
    },
    "select": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/selectItem"
      }
    },
    "where": {
      "oneOf": [
        {
          "$ref": "#/definitions/binaryCompareCondition"
        },
        {
          "$ref": "#/definitions/betweenCondition"
        },
        {
          "$ref": "#/definitions/inCondition"
        },
        {
          "$ref": "#/definitions/logicCondition"
        },
        {
          "$ref": "#/definitions/unaryExpression"
        }
      ]
    },
    "joins": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/joinItem"
      }
    },
    "groupBy": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "$ref": "#/definitions/fieldExpression"
          },
          {
            "$ref": "#/definitions/aggregateExpression"
          },
          {
            "$ref": "#/definitions/functionExpression"
          },
          {
            "$ref": "#/definitions/unaryExpression"
          },
          {
            "$ref": "#/definitions/literalExpression"
          },
          {
            "$ref": "#/definitions/parameterExpression"
          }
        ]
      }
    },
    "having": {
      "oneOf": [
        {
          "$ref": "#/definitions/binaryCompareCondition"
        },
        {
          "$ref": "#/definitions/betweenCondition"
        },
        {
          "$ref": "#/definitions/inCondition"
        },
        {
          "$ref": "#/definitions/logicCondition"
        },
        {
          "$ref": "#/definitions/unaryExpression"
        }
      ]
    },
    "orderBy": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/orderByItem"
      }
    },
    "pagination": {
      "$ref": "#/definitions/pagination"
    },
    "parameters": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/parameterDeclaration"
      }
    }
  },
  "required": [
    "from",
    "select"
  ],
  "title": "PureQL specification",
  "type": "object"
}
