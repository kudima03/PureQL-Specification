{
  "$id": "https://raw.githubusercontent.com/kudima03/PureQL-Specification/refs/heads/main/PureQL-Specification.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "additionalProperties": false,
  "definitions": {
    "betweenCondition": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "value",
        "min",
        "max"
      ],
      "properties": {
        "kind": {
          "const": "between"
        },
        "value": {
          "$ref": "#/definitions/expression"
        },
        "min": {
          "$ref": "#/definitions/expression"
        },
        "max": {
          "$ref": "#/definitions/expression"
        }
      }
    },
    "binaryCompareCondition": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "operator",
        "left",
        "right"
      ],
      "properties": {
        "kind": {
          "const": "compare"
        },
        "operator": {
          "type": "string",
          "enum": [
            "equal",
            "notEqual",
            "greaterThan",
            "greaterOrEqual",
            "lessThan",
            "lessOrEqual",
            "contains",
            "startsWith",
            "endsWith",
            "like"
          ]
        },
        "left": {
          "$ref": "#/definitions/expression"
        },
        "right": {
          "$ref": "#/definitions/expression"
        }
      }
    },
    "logicCondition": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "kind",
            "conditions"
          ],
          "properties": {
            "kind": {
              "enum": [
                "and",
                "or"
              ]
            },
            "conditions": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/conditionExpression"
              },
              "minItems": 1
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": [
            "kind",
            "condition"
          ],
          "properties": {
            "kind": {
              "const": "not"
            },
            "condition": {
              "$ref": "#/definitions/conditionExpression"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "inCompareCondition": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "left",
        "right"
      ],
      "properties": {
        "kind": {
          "enum": [
            "in",
            "notIn"
          ]
        },
        "left": {
          "$ref": "#/definitions/expression"
        },
        "right": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/expression"
          }
        }
      }
    },
    "fieldExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "entity",
        "name"
      ],
      "properties": {
        "kind": {
          "const": "field"
        },
        "entity": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "joinItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "entity",
        "on"
      ],
      "properties": {
        "type": {
          "enum": [
            "left",
            "right",
            "inner",
            "full"
          ]
        },
        "entity": {
          "type": "string",
          "minLength": 1
        },
        "on": {
          "$ref": "#/definitions/conditionExpression"
        }
      }
    },
    "aggregateExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "name",
        "arg"
      ],
      "properties": {
        "kind": {
          "const": "aggregate"
        },
        "name": {
          "type": "string",
          "enum": [
            "sum",
            "avg",
            "min",
            "max",
            "count"
          ]
        },
        "arg": {
          "$ref": "#/definitions/expression"
        }
      }
    },
    "functionExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "name",
        "args"
      ],
      "properties": {
        "kind": {
          "const": "function"
        },
        "name": {
          "type": "string",
          "enum": [
            "lower",
            "upper",
            "length",
            "trim",
            "contains",
            "abs",
            "round",
            "floor",
            "ceiling",
            "now",
            "date_add",
            "date_diff"
          ]
        },
        "args": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/expression"
          }
        }
      }
    },
    "unaryExpression": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "operator",
        "operand"
      ],
      "properties": {
        "kind": {
          "const": "unary"
        },
        "operator": {
          "type": "string",
          "enum": [
            "neg",
            "not"
          ]
        },
        "operand": {
          "$ref": "#/definitions/expression"
        }
      }
    }
  },
  "properties": {
    "distinct": {
      "type": "boolean",
      "default": false
    },
    "from": {
      "$ref": "#/definitions/fromEntity"
    },
    "select": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/selectItem"
      }
    },
    "where": {
      "$ref": "#/definitions/conditionExpression"
    },
    "joins": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/joinItem"
      }
    },
    "groupBy": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/expression"
      }
    },
    "having": {
      "$ref": "#/definitions/conditionExpression"
    },
    "orderBy": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/orderByItem"
      }
    },
    "pagination": {
      "$ref": "#/definitions/pagination"
    },
    "parameters": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/parameterDeclaration"
      }
    }
  },
  "required": [
    "from",
    "select"
  ],
  "title": "PureQL specification",
  "type": "object"
}
